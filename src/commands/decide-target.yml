description: >
  This command echos "Hello World" using file inclusion.
# What will this command do?
# Descriptions should be short, simple, and clear.
parameters:
  if-exist-return:
    type: string
    default: ""
    description: ""
  check-list:
    type: string
    default: ""
    description: "blue-mole,auth-mole-route,mole-route-electron"
  stop-no-target:
    type: boolean
    default: false
    description: ""

steps:
  - run:
      name: decide target
      command: |
        if [ -n << parameters.if-exist-return >> ]; then
          echo "export TARGET=<< parameters.if-exist-return >>" >> $BASH_ENV
        else
          commit_subject=$(git log -1 --pretty=%s | awk '{print $1}')
          reg=$(echo << parameters.check-list >> | sed -e 's/ //'  -e 's/,/|/')
          match=$(echo "${commit_subject}" | sed -rn "/.*\[${reg}\].*/p")
          echo ${match}
          if << parameters.stop-no-target >> && [ -z "${match}" ]; then
            circleci-agent step halt
          fi
          echo "export TARGET=`echo ${match} | sed -e 's/\[//' -e 's/\]//'`" >> $BASH_ENV
        fi
